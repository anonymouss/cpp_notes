# kNN

## 距离度量

$L_p(x_i, x_j) = ( \sum_{l=1}^n|x_i^{(l)} - x_j^{(l)}|^p )^{\frac{1}{p}}$

- $p = 1$ 曼哈顿距离

- $p = 2$ 欧氏距离

- $p = \infty$ 切比雪夫距离

## kNN 算法

1. 根据给定的距离度量，在训练集中找出与$x$最邻近的$k$个点，涵盖这$k$个点的$x$的邻域记作$N_k(x)$

2. 在$N_k(x)$中根据分类决策规则（如多数表决）决定$x$的类别$y$
   - $y = \arg\max_{c_j}{\sum_{x_i\in N_k(x)}I(y_i=c_j))}, i = 1, 2, \cdots, N; j = 1, 2, \cdots, K$

## kd tree 算法

### 构建 kd 树

输入：$k$维空间数据集$T = \left\{x_1, x_2, \cdots, x_N\right\}$

其中 $x_i = (x_i^{1}, x_i^{2}, \cdots, x_i^{k})^T, i=1, 2, \cdots, N$

输出：kd树

1. 开始：构造根结点，根结点对应于包含$T$的$k$维空间的超矩形区域。

    选择$x^{(1)}$为坐标轴，以T中所有实例的$x^{(1)}$坐标的中位数为切分点，将根结点对应的超矩形区域切分为两个子区域。切分由通过切分点并与坐标轴$x^{(1)}$垂直的超平面实现。

    由根结点生成深度为1的左、右子结点：左子结点对应坐标$x^{(1)}$小于切分点的子区域， 右子结点对应于坐标$x^{(1)}$大于切分点的子区域。

    将落在切分超平面上的实例点保存在根结点。

2. 重复：对深度为$j$的结点，选择$x^{(1)}$为切分的坐标轴，$l＝j  (modk)+1$，以该结点的区域中所有实例的$x^{(1)}$坐标的中位数为切分点，将该结点对应的超矩形区域切分为两个子区域。切分由通过切分点并与坐标轴$x^{(1)}$垂直的超平面实现。

    由该结点生成深度为$j+1$的左、右子结点：左子结点对应坐标$x^{(1)}$小于切分点的子区域，右子结点对应坐标$x^{(1)}$大于切分点的子区域。

    将落在切分超平面上的实例点保存在该结点。

3. 直到两个子区域没有实例存在时停止。从而形成kd树的区域划分。

### 搜索 kd 树

输入：已构造的kd树；目标点$x$

输出：$x$的最近邻

1. 在kd树中找出包含模板点$x$的叶子结点：从根结点出发，递归地向下访问kd树。若目标点$x$当前维的坐标小于切分点的坐标，则移动到左子结点；否则，移动到右子结点。知道子结点为叶子结点为止。

2. 以此叶结点为“当前最近点”

3. 递归地向上回退，在每个结点进行以下操作：

    a. 如果该结点保存的实例点比当前最近点距离目标更近，则以该实例点为“当前最近点”

    b. 当前最近点一定存在于该结点一个子结点对应的区域。检查该子结点的父结点的另一个子结点对应区域是否有更近的点。具体地，检查另一个子结点对应的区域是否与以目标点为球心、以目标掉与“当前最近点”间的距离为半径的超球体相交。若相交，可能在另一个子结点对应区域存在距离目标点更近的点，移动到到另一个子结点接着递归地进行最近邻搜索；若不相交，向上回退。

4. 当回退到根结点时，搜索结束。最后的 “当前最近点”即为$x$的最近邻点。